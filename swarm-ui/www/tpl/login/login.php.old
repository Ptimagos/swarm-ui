<?php
	session_start();
	//Inclusion du fichier de configuration
	require "../../../cfg/conf.php";
	
	//Inclusion des differentes librairies
	require "../../../lib/fonctions.php";
	require "../../../lib/mysql.php";
	require "../../../lib/psql.php";
	
	// Define $username and $password
	$username=$_POST['username'];
	$password=$_POST['password'];
	// Connexion a la base de donnees :
	$connexion = conMysql ($server);
	// To protect MySQL injection for Security purpose
	$username = stripslashes($username);
	$password = stripslashes($password);
	$username = mysql_real_escape_string($username);
	$password = mysql_real_escape_string($password);
	
	// SQL query to fetch information of registerd users and finds user match.
	$req="select * from ds_users where login='$username'";
	$resu = execRequete ($req, $connexion);
	$rows = nbLigne($resu);
	if ($rows == 1) {
		while ($res = ligneSuivante($resu)) {
			if (password_verify($password, $res->password)) {
				$_SESSION['login_id']=$res->id;
				$_SESSION['login_user']=$res->login;
				$_SESSION['login_name']=$res->name;
				$_SESSION['login_firstname']=$res->firstname;
				$_SESSION['login_profile']=$res->profile_id;
				print "<div class='bg-success' style='text-align:center'>You are now connected</div>";
			} else {
				print "<div class='bg-danger' style='text-align:center'>Invalid Password, try again.</div>";
			}
		}	
	} else {
		print "<div class='bg-danger' style='text-align:center'>Invalid User, try again.</div>";
	}
	// Deconnexion de la base de donnees :
	decMysql($connexion);
?>